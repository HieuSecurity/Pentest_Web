<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bình luận</title>
<link rel="stylesheet" href="styles.css">
</head>
<style>
    /* styles.css */

body {
    font-family: Arial, sans-serif;
    background-color: #f8f8f8;
    margin: 0;
    padding: 0;
    align-items: center;
    text-align: center;
    justify-content: center;
}
button {
    font-size: 25px;
    width: 300px;
    margin-left: 75%;
    padding: 10px;
    margin: 10px;
    
    
}
h1, h2 {
    color: #333;
}

#comments {
    margin-bottom: 20px;
}

.comment {
    background-color: #fff;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 5px;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
}

.comment p {
    margin: 0;
}

form {
    background-color: #fff;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    
}
ul {
    padding: 5px;
    margin-left: 20px;
    align-items: center;
    text-align: center;
}
li {
    padding: 10px;
    margin: 10px;
    font-size: 30px;
    list-style: none;
    font-weight: 700;

}
label {
    font-weight: bold;
}
button {
    background-color: #007bff;
}

input[type="text"],
textarea {
    width: 400px;
    padding: 8px;
    margin-bottom: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 20px;
}

input[type="submit"] {
    background-color: #007bff;
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 25px;
    width: 300px;
}

input[type="submit"]:hover {
    background-color: #0056b3;
}

</style>
<body >
<div id="comments">
</div>
<div id="userInfoDiv">

</div>
<button id="check_profille">Xem hồ sơ người dùng !</button>
<button id="logoutBtn">Thoát đăng nhập</button>
<form action="comment.php" method="POST">
    <textarea id="comment" name="comment" required></textarea><br>
    <input type="submit" value="Submit">
</form>

<div id="container_comments">
    
</div>

<?php

$servername = "localhost";
$username = "goodog";
$password = "Ptit2021";
$dbname = "goodog";
$conn = new mysqli($servername, $username, $password, $dbname);
// Kiểm tra kết nối
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}
 session_start();



function addComment($comment)
{
    // Kết nối đến cơ sở dữ liệu
    $servername = "localhost";
    $username = "goodog";
    $password = "Ptit2021";
    $dbname = "goodog";

    $conn = new mysqli($servername, $username, $password, $dbname);

    // Kiểm tra kết nối

    // Bảo vệ khỏi SQL Injection

    // Thêm bình luận mới vào cơ sở dữ liệu
    $username = $_COOKIE['username'];
    $sql = "INSERT INTO comments (username, content) VALUES ('$username', '$comment')";
    if ($conn->query($sql) === TRUE) {
        header("Location: comment.php");
    } else {
        echo "Error: " . $sql . "<br>" . $conn->error;
    }

    $conn->close();
}

// Sử dụng hàm addComment() khi người dùng gửi bình luận
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    if (isset($_POST['comment'])) {
        $comment = $_POST['comment'];
        addComment($comment);

    }
}

?>

<script>
     var username = "<?php echo isset($_COOKIE['username']) ? $_COOKIE['username'] : ''; ?>";
    var userInfoDiv = document.getElementById("userInfoDiv");
    userInfoDiv.innerHTML +=`<li>Người dùng : ${username}</li>`
    function getComments() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var comments = JSON.parse(this.responseText);
                var commentsDiv = document.getElementById("container_comments");
                commentsDiv.innerHTML = "";
                comments.forEach(function(comment) {
                    commentsDiv.innerHTML += "<li>" + comment.username + ": " + comment.content +  "</li>";
                });
            }
        };
        xhttp.open("GET", "get_comments.php", true);
        xhttp.send();
       
}
   

    getComments();  

    // setInterval(getComments, 5000); // Cập nhật mỗi 5 giây (5000 milliseconds)

    
    document.getElementById("logoutBtn").addEventListener("click", function() {
        // Gửi yêu cầu AJAX để xử lý việc đăng xuất
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                // Đăng xuất thành công, chuyển hướng người dùng về trang đăng nhập
                window.location.href = "Login.php"; // Điều hướng đến trang logout.php hoặc trang đăng nhập của bạn
            }
        };
        xhttp.open("GET", "Login.php", true); // Gửi yêu cầu GET đến trang logout.php
        xhttp.send();
    });


    document.getElementById("check_profille").addEventListener("click", function() {
    window.location.href = "check_profile.php"; // Chuyển hướng sang trang profile.php khi nhấn vào nút "Xem hồ sơ người dùng"
});


</script>





</body>
</html>
